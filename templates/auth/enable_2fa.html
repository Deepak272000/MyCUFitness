{% extends "base.html" %}
{% block title %}Enable 2FA{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card shadow-lg p-4">
            <h2 class="text-center">Enable Two-Factor Authentication</h2>
            <p class="text-center">Scan the QR code below in your authenticator app (e.g., Google Authenticator).</p>
            <div id="qrCode" class="text-center"></div>
            <button id="enable2FAButton" class="btn btn-primary mt-3 w-100">Enable 2FA</button>
            <div id="message" class="mt-3 text-center"></div>
        </div>
    </div>
</div>

<script>
document.getElementById("enable2FAButton").addEventListener("click", function() {
    fetch("{% url 'enable-2fa' %}", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + localStorage.getItem("token"),
            "X-CSRFToken": "{{ csrf_token }}"
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.qr_code) {
            document.getElementById("qrCode").innerHTML = `<img src="${data.qr_code}" alt="QR Code">`;
            document.getElementById("message").innerHTML = "<div class='alert alert-success'>2FA Enabled Successfully!</div>";
        } else {
            document.getElementById("message").innerHTML = "<div class='alert alert-danger'>Error enabling 2FA.</div>";
        }
    })
    .catch(error => console.error("Error:", error));
});
</script>
{% endblock %}
